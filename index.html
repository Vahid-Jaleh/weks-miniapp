<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WEKS Tap-To-Math</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#111; color:#fff; margin:0; padding:24px; text-align:center; }
    h1 { margin: 0 0 8px; }
    .sub { opacity:.8; margin-bottom:20px; }
    .card { margin:0 auto; max-width:420px; background:#1c1c1c; padding:20px; border-radius:14px; box-shadow:0 4px 16px rgba(0,0,0,.5); }
    .q { font-size:28px; margin:18px 0; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    button { padding:14px 10px; border:0; border-radius:12px; font-size:18px; cursor:pointer; background:#ffd54a; }
    .meta { margin:14px 0 4px; font-size:14px; opacity:.8; }
    .ok { color:#6ee78c; }
    .bad { color:#ff7a7a; }
  </style>
</head>
<body>
  <h1>ðŸŽ° WEKS Tap-To-Math</h1>
  <div class="sub">Solve, stack correct answers, then <b>Claim</b> to get coins.</div>

  <div class="card">
    <div id="status" class="meta">Correct: <span id="c">0</span> â€¢ Wrong: <span id="w">0</span></div>
    <div id="q" class="q">Loadingâ€¦</div>
    <div class="grid" id="answers"></div>
    <div class="meta">Daily cap: 100 Q â†’ +10 coins each</div>
    <div id="flash" class="meta"></div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();
    tg.MainButton.setText("Claim & Close");
    tg.MainButton.show();

    let correct = 0, wrong = 0, current = null;

    function randint(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }

    function newQuestion(){
      const ops = ["+","-","Ã—","Ã·"];
      const op = ops[randint(0,ops.length-1)];
      let a = randint(2,25), b = randint(2,25), ans=0;

      if(op==="+"){ ans = a+b; }
      if(op==="-"){ if(b>a){ [a,b]=[b,a]; } ans=a-b; }
      if(op==="Ã—"){ ans=a*b; }
      if(op==="Ã·"){
        ans = randint(2,12);
        b = randint(2,12);
        a = ans*b;
      }

      current = { text: `${a} ${op} ${b} = ?`, ans };
      document.getElementById("q").textContent = current.text;

      const opts = new Set([ans]);
      while(opts.size<4){
        const delta = randint(1,10);
        const sign = Math.random()<0.5?-1:1;
        opts.add(ans + sign*delta);
      }
      const shuffled = Array.from(opts).sort(()=>Math.random()-0.5);

      const box = document.getElementById("answers");
      box.innerHTML = "";
      shuffled.forEach(v=>{
        const btn = document.createElement("button");
        btn.textContent = v;
        btn.onclick = ()=>choose(v);
        box.appendChild(btn);
      });
      flash("");
    }

    function flash(text, good){
      const f = document.getElementById("flash");
      f.textContent = text;
      f.className = "meta " + (good===true?"ok":good===false?"bad":"");
    }

    function choose(v){
      if(!current) return;
      if(Number(v)===current.ans){
        correct++; flash("Correct! Ready to claim later âœ…", true);
      } else {
        wrong++; flash(`Oops! Correct was ${current.ans}`, false);
      }
      document.getElementById("c").textContent = correct;
      document.getElementById("w").textContent = wrong;
      newQuestion();
      tg.HapticFeedback.notificationOccurred("success");
    }

    tg.MainButton.onClick(()=>{
      // Send one claim with total correct; Telegram will close the webview.
      const payload = JSON.stringify({ t:"claim", correct });
      tg.sendData(payload);
    });

    newQuestion();
  </script>
</body>
</html>
